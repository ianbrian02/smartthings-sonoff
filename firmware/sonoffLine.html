<html>
<head>
    <title>SmartThings Sonoff Basic</title>
    <style>      body {
        background-color: #cccccc;
        font-family: Arial, Helvetica, Sans-Serif;
        Color: #000088;
    }    </style>
</head>
<body><h1>SmartThings Sonoff Basic!</h1>
<p id="uptime">Uptime: </p>
<p id="relay">Relay</p>
<p id="wifi">WiFi:</p>
<p id="ip">Ip:</p>
<p id="mac">MAc:</p>
<form action="/toggle" method="post"><input type="submit" value="Toggle Relay"></form>
<br/>
<br/>
<div id="config">

</div>
</body>
<script>
  function state(success, error) {
    var req = new XMLHttpRequest();
    req.open('GET', '/state', true);
    req.setRequestHeader('Accept', 'application/json');

    req.onreadystatechange = function () {
      if (req.readyState == 4) {
        if (req.status == 200) {
          success(req.responseText);
        } else {
          error();
        }
      }
    };

    req.send();
  }

  state(function (data) {
    var json = JSON.parse(data);
    var uptimeP = document.getElementById('uptime');
    uptimeP.innerText='Uptime:'+json.uptime/1000+' seconds';
    var relayP = document.getElementById('relay');
    relayP.innerText='Relay:'+json.relay;
    var wifiP = document.getElementById('wifi');
    wifiP.innerText='Ssid:'+json.ssid;
    var ipP = document.getElementById('ip');
    ipP.innerText='ip:'+json.ip;
    var macP = document.getElementById('mac');
    macP.innerText='mac:'+json.mac;
    var configDiv = document.getElementById('config');
    while (configDiv.firstChild) {
      configDiv.removeChild(configDiv.firstChild);
    }
    var f = document.createElement('form');
    f.setAttribute('method', 'post');
    f.setAttribute('action', 'config');

    var applicationId = document.createElement('input');
    applicationId.setAttribute('type', 'text');
    applicationId.setAttribute('name', 'applicationId');
    applicationId.setAttribute('value', json.applicationId);

    var accessToken = document.createElement('input');
    accessToken.setAttribute('type', 'text');
    accessToken.setAttribute('name', 'accessToken');
    accessToken.setAttribute('value', json.accessToken);

    var smartThingsUrl = document.createElement('input');
    smartThingsUrl.setAttribute('type', 'text');
    smartThingsUrl.setAttribute('name', 'smartThingsUrl');
    smartThingsUrl.setAttribute('value', json.smartThingsUrl);

    var defaultState = document.createElement('select');
    defaultState.setAttribute('name', 'defaultState');

    var option1 = document.createElement('option');
    option1.setAttribute('value','0');
    option1.innerText='off';

    var option2 = document.createElement('option');
    option2.setAttribute('value','1');
    option2.innerText='on';

    var option3 = document.createElement('option');
    option3.setAttribute('value','2');
    option3.innerText='last';

    defaultState.add(option1);
    defaultState.add(option2);
    defaultState.add(option3);

    defaultState.value =json.defaultState;
    var save = document.createElement('input'); //input element, Submit button
    save.setAttribute('type', 'submit');
    save.setAttribute('value', 'Save');
    var paragraphElement1 = document.createElement('p');
    paragraphElement1.innerText = 'Smartthings Application Id: '
    f.appendChild(paragraphElement1);
    paragraphElement1.appendChild(applicationId);
    f.appendChild(document.createElement('br'));
    var paragraphElement2 = document.createElement('p');
    paragraphElement2.innerText = 'Smartthings Access Token:'
    f.appendChild(paragraphElement2);
    paragraphElement2.appendChild(accessToken);
    f.appendChild(document.createElement('br'));
    var paragraphElement3 = document.createElement('p');
    paragraphElement3.innerText = 'Smartthings Url:'
    f.appendChild(paragraphElement3);
    paragraphElement3.appendChild(smartThingsUrl);
    f.appendChild(document.createElement('br'));
    var paragraphElement4 = document.createElement('p');
    paragraphElement4.innerText = 'Relay Default State:'
    f.appendChild(paragraphElement4);
    paragraphElement4.appendChild(defaultState);
    f.appendChild(document.createElement('br'));
    f.appendChild(document.createElement('br'));
    f.appendChild(save);


    configDiv.appendChild(f);
    //debugger;
    //configDiv.ch
  })

</script>
</html>